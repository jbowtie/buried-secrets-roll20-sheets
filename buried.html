<div class="main">
    <div class="header flex-center section">
        <h1><input name="attr_class" type="text" /></h1>
        <p>Name: <input name="attr_character_name" type="text" /></p>
        <label>Stress: <input type="number" name="attr_stress" value="0"/></label>
    </div>
    <div class="insight section">
        <input type="hidden" name="attr_insight" value="0" />
        <h3>Insight <button type="roll" title="Resist deception" value="&amp;{template:resist} {{name=@{character_name}}} {{attr=Insight}} {{attr_num=[[@{insight}]]}} {{zero=[[6-2d6kl1]]}} {{stress=[[6-(@{insight})d6kh1]]}}"></button></h3>
        <label class="lbl"><input type="number" name="attr_hunt" value="0" /> <button type="roll" value="&amp;{template:action} {{name=@{character_name}}} {{attr=Hunt}} {{attr_num=[[@{hunt}+?{Bonus Dice|0|1|2|3|-1|-2|-3}]]}} {{zero=[[2d6kl1]]}} {{dice=[[(@{hunt}+?{Bonus Dice|0|1|2|3|-1|-2|-3})d6kh1]]}}">Hunt</button></label>
        <label class="lbl"><input type="number" name="attr_study" value="0" /> <button type="roll" value="&amp;{template:action} {{name=@{character_name}}} {{attr=Study}} {{attr_num=[[@{study}+?{Bonus Dice|0|1|2|3|-1|-2|-3}]]}} {{zero=[[2d6kl1]]}} {{dice=[[(@{study}+?{Bonus Dice|0|1|2|3|-1|-2|-3})d6kh1]]}}">Study</button></label>
        <label class="lbl"><input type="number" name="attr_survey" value="0" /> <button type="roll" value="&amp;{template:action} {{name=@{character_name}}} {{attr=Survey}} {{attr_num=[[@{survey}+?{Bonus Dice|0|1|2|3|-1|-2|-3}]]}} {{zero=[[2d6kl1]]}} {{dice=[[(@{survey}+?{Bonus Dice|0|1|2|3|-1|-2|-3})d6kh1]]}}">Survey</button></label>
        <label class="lbl"><input type="number" name="attr_tinker" value="0" /> <button type="roll" value="&amp;{template:action} {{name=@{character_name}}} {{attr=Tinker}} {{attr_num=[[@{tinker}+?{Bonus Dice|0|1|2|3|-1|-2|-3}]]}} {{zero=[[2d6kl1]]}} {{dice=[[(@{tinker}+?{Bonus Dice|0|1|2|3|-1|-2|-3})d6kh1]]}}">Tinker</button></label>
    </div>
    <div class="prowess section">
        <input type="hidden" name="attr_prowess" value="0" />
        <h3>Prowess<button type="roll" title="Resist physical damage" value="&amp;{template:resist} {{name=@{character_name}}} {{attr=Prowess}} {{attr_num=[[@{prowess}]]}} {{zero=[[6-2d6kl1]]}} {{stress=[[6-(@{prowess})d6kh1]]}}"></button></h3>
        <label class="lbl"><input type="number" name="attr_finesse" value="0" /> <button type="roll" value="&amp;{template:action} {{name=@{character_name}}} {{attr=Finesse}} {{attr_num=[[@{finesse}+?{Bonus Dice|0|1|2|3|-1|-2|-3}]]}} {{zero=[[2d6kl1]]}} {{dice=[[(@{finesse}+?{Bonus Dice|0|1|2|3|-1|-2|-3})d6kh1]]}}">Finesse</button></label>
        <label class="lbl"><input type="number" name="attr_prowl" value="0" /> <button type="roll" value="&amp;{template:action} {{name=@{character_name}}} {{attr=Prowl}} {{attr_num=[[@{prowl}+?{Bonus Dice|0|1|2|3|-1|-2|-3}]]}} {{zero=[[2d6kl1]]}} {{dice=[[(@{prowl}+?{Bonus Dice|0|1|2|3|-1|-2|-3})d6kh1]]}}">Prowl</button></label>
        <label class="lbl"><input type="number" name="attr_skirmish" value="0" /> <button type="roll" value="&amp;{template:action} {{name=@{character_name}}} {{attr=Skirmish}} {{attr_num=[[@{skirmish}+?{Bonus Dice|0|1|2|3|-1|-2|-3}]]}} {{zero=[[2d6kl1]]}} {{dice=[[(@{skirmish}+?{Bonus Dice|0|1|2|3|-1|-2|-3})d6kh1]]}}">Skirmish</button></label>
        <label class="lbl"><input type="number" name="attr_wreck" value="0" /> <button type="roll" value="&amp;{template:action} {{name=@{character_name}}} {{attr=Wreck}} {{attr_num=[[@{wreck}+?{Bonus Dice|0|1|2|3|-1|-2|-3}]]}} {{zero=[[2d6kl1]]}} {{dice=[[(@{wreck}+?{Bonus Dice|0|1|2|3|-1|-2|-3})d6kh1]]}}">Wreck</button></label>
    </div>
    <div class="resolve section">
        <input type="hidden" name="attr_resolve" value="0" />
        <h3>Resolve<button type="roll" title="Resist mental strain" value="&amp;{template:resist} {{name=@{character_name}}} {{attr=Resolve}} {{attr_num=[[@{resolve}]]}} {{zero=[[6-2d6kl1]]}} {{stress=[[6-(@{resolve})d6kh1]]}}"></button></h3>
        <label class="lbl"><input type="number" name="attr_attune" value="0" /> <button type="roll" value="&amp;{template:action} {{name=@{character_name}}} {{attr=Attune}} {{attr_num=[[@{attune}+?{Bonus Dice|0|1|2|3|-1|-2|-3}]]}} {{zero=[[2d6kl1]]}} {{dice=[[(@{attune}+?{Bonus Dice|0|1|2|3|-1|-2|-3})d6kh1]]}}">Attune</button></label>
        <label class="lbl"><input type="number" name="attr_command" value="0" /> <button type="roll" value="&amp;{template:action} {{name=@{character_name}}} {{attr=Command}} {{attr_num=[[@{command}+?{Bonus Dice|0|1|2|3|-1|-2|-3}]]}} {{zero=[[2d6kl1]]}} {{dice=[[(@{command}+?{Bonus Dice|0|1|2|3|-1|-2|-3})d6kh1]]}}">Command</button></label>
        <label class="lbl"><input type="number" name="attr_consort" value="0" /> <button type="roll" value="&amp;{template:action} {{name=@{character_name}}} {{attr=Consort}} {{attr_num=[[@{consort}+?{Bonus Dice|0|1|2|3|-1|-2|-3}]]}} {{zero=[[2d6kl1]]}} {{dice=[[(@{consort}+?{Bonus Dice|0|1|2|3|-1|-2|-3})d6kh1]]}}">Consort</button></label>
        <label class="lbl"><input type="number" name="attr_sway" value="0" /> <button type="roll" value="&amp;{template:action} {{name=@{character_name}}} {{attr=Sway}} {{attr_num=[[@{sway}+?{Bonus Dice|0|1|2|3|-1|-2|-3}]]}} {{zero=[[2d6kl1]]}} {{dice=[[(@{sway}+?{Bonus Dice|0|1|2|3|-1|-2|-3})d6kh1]]}}">Sway</button></label>
    </div>
    <div class="power section flex-col">
      <label>Special Abilities</label>
      <fieldset class="repeating_power">
          <textarea name="attr_power" type="text"></textarea>
      </fieldset>
    </div>
    <div class="misc section">
      <label>Notes</label>
      <textarea name="attr_notes"></textarea>
    </div>
    <div class="footer flex-col">
      <span>Generic copyright disclaimer</span>
    </div>
</div>
<rolltemplate class="sheet-rolltemplate-action">
<h1>{{name}}</h1>
<h2>{{attr}}</h2>
{{#rollGreater() attr_num 0}}
<p><em>Rolling {{attr_num}} dice</em></p>
<p class="center">{{dice}}</p>
{{#rollLess() dice 4}}
<h3>Failed</h3>
{{/rollLess() dice 4}}
{{#rollBetween() dice 4 5}}
<h3>Partial success</h3>
{{/rollBetween() dice 4 5}}
{{#rollGreater() dice 5}}
<h3>Success</h3>
{{#rollGreater() attr_num 1}}
<p>Mouse over roll to count sixes</p>
{{/rollGreater() attr_num 1}}
{{/rollGreater() dice 5}}
{{/rollGreater() attr_num 0}}
{{#rollLess() attr_num 1}}
<p><em>Rolling 0 dice</em></p>
<p class="center">{{zero}}</p>
{{#rollLess() zero 4}}
<h3>Failed</h3>
{{/rollLess() zero 4}}
{{#rollBetween() zero 4 5}}
<h3>Partial success</h3>
{{/rollBetween() zero 4 5}}
{{#rollGreater() zero 5}}
<h3>Success</h3>
{{/rollGreater() zero 5}}
{{/rollLess() attr_num 1}}
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-resist">
<h1>{{name}}</h1>
<h2>{{attr}}</h2>
{{#rollGreater() attr_num 0}}
<p><em>Rolling {{attr_num}} dice</em></p>
<h3>Gain {{stress}} stress</h3>
{{#rollLess() stress 1}}
{{#rollGreater() attr_num 1}}
<p>If critical, REDUCE stress by 1</p>
{{/rollGreater() attr_num 1}}
{{/rollLess() stress 1}}
{{/rollGreater() attr_num 0}}
{{#rollLess() attr_num 1}}
<p><em>Rolling 0 dice</em></p>
<h3>Gain {{zero}} stress</h3>
{{/rollLess() attr_num 1}}
</rolltemplate>
<script type="text/worker">
on( "change:hunt change:study change:survey change:tinker", function() {
   getAttrs(["hunt", "study", "survey", "tinker"], function(values) {
    let val = Object.keys(values).filter(key => values[key] > 0).length;
    setAttrs({insight: val});
   });
});
on( "change:finesse change:prowl change:skirmish change:wreck", function() {
   getAttrs(["finesse", "prowl", "skirmish", "wreck"], function(values) {
    let val = Object.keys(values).filter(key => values[key] > 0).length;
    setAttrs({prowess: val});
   });
});
on( "change:attune change:command change:consort change:sway", function() {
   getAttrs(["attune", "command", "consort", "sway"], function(values) {
    let val = Object.keys(values).filter(key => values[key] > 0).length;
    setAttrs({resolve: val});
   });
});
</script>
